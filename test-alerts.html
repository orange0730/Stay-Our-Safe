<!DOCTYPE html>
<html>
<head>
    <title>Ê∏¨Ë©¶ Alerts API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üö® Alerts API Ê∏¨Ë©¶</h1>
    
    <button onclick="testAlertsEndpoint()">Ê∏¨Ë©¶ /api/alerts/recent</button>
    <button onclick="testBackendHealth()">Ê∏¨Ë©¶ÂæåÁ´ØÂÅ•Â∫∑</button>
    <button onclick="clearResults()">Ê∏ÖÈô§ÁµêÊûú</button>
    
    <div id="results"></div>
    
    <script>
        const API_BASE = 'http://localhost:3001';
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            document.getElementById('results').appendChild(div);
        }
        
        async function testBackendHealth() {
            try {
                addResult('üîç Ê∏¨Ë©¶ÂæåÁ´ØÂÅ•Â∫∑Ê™¢Êü•...', 'info');
                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ ÂæåÁ´ØÂÅ•Â∫∑Ê™¢Êü•ÊàêÂäü: ${JSON.stringify(data)}`, 'success');
                } else {
                    addResult(`‚ö†Ô∏è ÂæåÁ´ØÂÅ•Â∫∑Ê™¢Êü•Áï∞Â∏∏: ${response.status}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå ÂæåÁ´ØÂÅ•Â∫∑Ê™¢Êü•Â§±Êïó: ${error.message}`, 'error');
            }
        }
        
        async function testAlertsEndpoint() {
            try {
                addResult('üîç Ê∏¨Ë©¶ /api/alerts/recent Á´ØÈªû...', 'info');
                
                // Ê∏¨Ë©¶Ë´ãÊ±Ç
                const response = await fetch(`${API_BASE}/api/alerts/recent`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult(`üìä ÈüøÊáâÁãÄÊÖã: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('‚úÖ ÊàêÂäüÁç≤Âèñ alerts Êï∏Êìö!', 'success');
                    
                    // È°ØÁ§∫Ë©≥Á¥∞Êï∏Êìö
                    const alertCount = data.data?.recentAlerts?.length || 0;
                    const assessmentCount = data.data?.recentAssessments?.length || 0;
                    
                    addResult(`üìà Êï∏ÊìöÁµ±Ë®à: ${alertCount} Á≠ÜË≠¶Â†±, ${assessmentCount} Á≠Ü AI Ë©ï‰º∞`);
                    
                    // È°ØÁ§∫ÂéüÂßãÊï∏Êìö (Êà™Êñ∑È°ØÁ§∫)
                    const jsonStr = JSON.stringify(data, null, 2);
                    const truncatedJson = jsonStr.length > 1000 ? jsonStr.substring(0, 1000) + '...' : jsonStr;
                    addResult(`<pre>${truncatedJson}</pre>`);
                    
                    // Ê∏¨Ë©¶Êï∏ÊìöÁµêÊßã
                    if (data.data?.recentAlerts) {
                        addResult('‚úÖ recentAlerts Â≠óÊÆµÂ≠òÂú®', 'success');
                        if (data.data.recentAlerts.length > 0) {
                            const firstAlert = data.data.recentAlerts[0];
                            addResult(`üìÑ Á¨¨‰∏ÄÁ≠ÜË≠¶Â†±: ${firstAlert.type} - ${firstAlert.description}`);
                        }
                    } else {
                        addResult('‚ùå recentAlerts Â≠óÊÆµÁº∫Â§±', 'error');
                    }
                    
                    if (data.data?.recentAssessments) {
                        addResult('‚úÖ recentAssessments Â≠óÊÆµÂ≠òÂú®', 'success');
                        if (data.data.recentAssessments.length > 0) {
                            const firstAssessment = data.data.recentAssessments[0];
                            addResult(`üìä Á¨¨‰∏ÄÁ≠ÜË©ï‰º∞: È¢®Èö™Á≠âÁ¥ö ${firstAssessment.overallRisk}/4`);
                        }
                    } else {
                        addResult('‚ùå recentAssessments Â≠óÊÆµÁº∫Â§±', 'error');
                    }
                    
                } else {
                    const errorText = await response.text();
                    addResult(`‚ùå API ÈåØË™§ (${response.status}): ${errorText}`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Á∂≤Ë∑ØÈåØË™§: ${error.message}`, 'error');
                console.error('ÂÆåÊï¥ÈåØË™§:', error);
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Ëá™ÂãïÊ∏¨Ë©¶
        window.onload = () => {
            addResult('üöÄ È†ÅÈù¢Âä†ËºâÂÆåÊàêÔºåÈñãÂßãËá™ÂãïÊ∏¨Ë©¶...');
            setTimeout(() => {
                testBackendHealth();
                setTimeout(() => {
                    testAlertsEndpoint();
                }, 2000);
            }, 1000);
        };
    </script>
</body>
</html> 